apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-notifications-cm
  namespace: argocd
data:
  service.slack: |
    token: $slack-token

  template.app-sync-succeeded: |
    message: |
      ğŸŸ¢ *{{.app.metadata.name}}* ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ê°€ ì„±ê³µí–ˆìŠµë‹ˆë‹¤.
    slack:
      attachments: |
        [{
          "title": "{{.app.metadata.name}}",
          "title_link": "{{.context.argocdUrl}}/applications/{{.app.metadata.name}}",
          "color": "#18be52",
          "fields": [
            {
              "title": "ë°°í¬ ìƒíƒœ",
              "value": "`{{.app.status.sync.status}}`",
              "short": true
            },
            {
              "title": "í—¬ìŠ¤ ìƒíƒœ",
              "value": "`{{.app.destNamespace}}`",
              "short": true
            },
            {
              "title": "ì ìš©ëœ ë²„ì „ (Revision)",
              "value": "`{{.app.status.sync.revision}}`",
              "short": false
            }
          ]
        }]
  template.app-sync-failed: |
    message: |
      ğŸ”´ *{{.app.metadata.name}}* ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
    slack:
      attachments: |
        [{
          "title": "{{.app.metadata.name}}",
          "title_link": "{{.context.argocdUrl}}/applications/{{.app.metadata.name}}",
          "color": "#E02334",
          "fields": [
            {
              "title": "ë°°í¬ ìƒíƒœ",
              "value": "`{{.app.status.sync.status}}`",
              "short": true
            },
            {
              "title": "í—¬ìŠ¤ ìƒíƒœ",
              "value": "`{{.app.status.health.status}}`",
              "short": true
            },
            {
              "title": "ì ìš©ëœ ë²„ì „ (Revision)",
              "value": "`{{.app.status.sync.revision}}`",
              "short": false
            }
          ]
        }]
  template.app-health-degraded: |
    message: |
      ğŸŸ¡ *{{.app.metadata.name}}* ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í—¬ìŠ¤ ìƒíƒœê°€ ë¹„ì •ìƒì…ë‹ˆë‹¤.
    slack:
      attachments: |
        [{
          "title": "{{.app.metadata.name}}",
          "title_link": "{{.context.argocdUrl}}/applications/{{.app.metadata.name}}",
          "color": "#fdc521",
          "fields": [
            {
              "title": "í—¬ìŠ¤ ìƒíƒœ",
              "value": "`{{.app.status.health.status}}`",
              "short": true
            },
            {
              "title": "ë°°í¬ ìƒíƒœ",
              "value": "`{{.app.status.sync.status}}`",
              "short": true
            }
          ]
        }]
  trigger.on-sync-succeeded: |
    - description: Application syncing has succeeded
      send:
      - app-sync-succeeded
      when: app.status.operationState.phase in ['Succeeded']

  trigger.on-sync-failed: |
    - description: Application syncing has failed
      send:
      - app-sync-failed
      when: app.status.operationState.phase in ['Failed', 'Error']

  trigger.on-health-degraded: |
    - description: Application has degraded
      send:
      - app-health-degraded
      when: app.status.health.status == 'Degraded'